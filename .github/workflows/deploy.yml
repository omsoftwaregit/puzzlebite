name: Deploy React + Vite to S3
 
on:

  push:

    branches:

      - main  # Change if your main branch is different
 
jobs:

  deploy:

    runs-on: ubuntu-latest
 
    steps:

      # Step 1: Checkout code

      - name: Checkout repository

        uses: actions/checkout@v3
 
      # Step 2: Setup Node.js (must match your local Node version)

      - name: Setup Node.js

        uses: actions/setup-node@v3

        with:

          node-version: '20'
 
      # Step 3: Install dependencies

      - name: Install dependencies

        run: npm ci
 
      # Step 4: Build the React + Vite app

      - name: Build Vite React app

        run: npm run build
 
      # Step 5: Configure AWS credentials for S3 deployment

      - name: Configure AWS credentials

        uses: aws-actions/configure-aws-credentials@v2

        with:

          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}

          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}

          aws-region: ap-south-1
 
      # Step 6: Deploy build folder to S3 bucket

      - name: Deploy to S3

        run: |

          echo "Syncing dist/ to S3 bucket..."

          aws s3 sync dist/ s3://puzzlebite-frontend/ --delete

          echo "Deployment complete!"
 
      # Step 7 (Optional): Invalidate CloudFront cache if using CloudFront

      #- name: Invalidate CloudFront cache

      #  run: |

      #    aws cloudfront create-invalidation --distribution-id E2GI074S0ZEA1R --paths "/*"

 